<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìˆ«ê¸€ ë³€í™˜ê¸° ( Soowim ì œì‘ )</title>

    <link rel="shortcut icon" href="icon.ico" type="image/x-icon">
    <link rel="icon" href="icon.ico" type="image/x-icon">

    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            line-height: 1.6;
            display: flex;
            justify-content: center;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 600px;
            margin-top: 20px;
            position: relative;
            padding-bottom: 60px;
        }

        h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
            letter-spacing: -0.5px;
            color: #ffffff;
        }

        .section {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 8px;
            color: #888;
            text-transform: uppercase;
        }

        textarea {
            width: 100%;
            height: 140px;
            padding: 14px;
            border: 1px solid #333;
            border-radius: 12px;
            font-size: 16px;
            background-color: #1e1e1e;
            color: #ffffff;
            transition: border-color 0.2s;
            resize: none;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }

        textarea:focus {
            outline: none;
            border-color: #555;
        }

        .btn-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 20px 0;
        }

        button {
            padding: 16px;
            border: none;
            border-radius: 12px;
            background-color: #ffffff;
            color: #000000;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button.secondary {
            background-color: #333;
            color: #ffffff;
        }

        button:active {
            opacity: 0.8;
        }

        .result-label {
            margin-top: 2rem;
            border-top: 1px solid #222;
            padding-top: 1.5rem;
        }

        #result {
            min-height: 100px;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 1.15rem;
            font-weight: 500;
            color: #ffffff;
            padding: 10px 0;
            letter-spacing: 0.5px;
        }

        footer {
            text-align: center;
            margin-top: 40px;
            font-size: 0.8rem;
            color: #555;
            letter-spacing: 1px;
        }
    </style>
</head>

<body>

    <div class="container">
        <h1>ğŸ” // ìˆ«ê¸€ ë³€í™˜ê¸°</h1>

        <div class="section">
            <label>Input</label>
            <textarea id="input" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
        </div>

        <div class="btn-group">
            <button onclick="toNum()">í•œê¸€ â†’ ìˆ«ê¸€</button>
            <button class="secondary" onclick="toKor()">ìˆ«ê¸€ â†’ í•œê¸€</button>
        </div>

        <div class="section result-label">
            <label>Result</label>
            <div id="result"></div>
        </div>

        <footer>Soowim ì œì‘</footer>
    </div>

    <script>
        const initialMap = { 'ã„±': '1', 'ã„²': '011', 'ã„´': '2', 'ã„·': '3', 'ã„¸': '033', 'ã„¹': '4', 'ã…': '5', 'ã…‚': '6', 'ã…ƒ': '066', 'ã……': '7', 'ã…†': '077', 'ã…‡': '8', 'ã…ˆ': '9', 'ã…‰': '099', 'ã…Š': '10', 'ã…‹': '11', 'ã…Œ': '12', 'ã…': '13', 'ã…': '14' };
        const vowelMap = { 'ã…': ['01'], 'ã…': ['102'], 'ã…‘': ['02'], 'ã…’': ['103'], 'ã…“': ['03'], 'ã…”': ['104'], 'ã…•': ['04'], 'ã…–': ['105'], 'ã…—': ['05'], 'ã…˜': ['05', '01'], 'ã…™': ['05', '102'], 'ã…š': ['05', '101'], 'ã…›': ['06'], 'ã…œ': ['07'], 'ã…': ['07', '03'], 'ã…': ['07', '104'], 'ã…Ÿ': ['07', '101'], 'ã… ': ['08'], 'ã…¡': ['09'], 'ã…¢': ['09', '101'], 'ã…£': ['101'] };
        const finalMap = ['', '1', '011', '17', '2', '29', '214', '3', '4', '41', '45', '46', '47', '412', '413', '414', '5', '6', '67', '7', '077', '8', '9', '10', '11', '12', '13', '14'];
        const CHOSUNG = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        const JUNGSUNG = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£'];

        function toNum() {
            const text = document.getElementById('input').value;
            let tokens = [];
            let i = 0;

            while (i < text.length) {
                let char = text[i];
                let code = char.charCodeAt(0);
                if (code >= 0xAC00 && code <= 0xD7A3) {
                    let n = code - 0xAC00;
                    let jong = n % 28;
                    let jung = ((n - jong) / 28) % 21;
                    let cho = Math.floor(((n - jong) / 28) / 21);
                    let parts = [initialMap[CHOSUNG[cho]], ...vowelMap[JUNGSUNG[jung]]];
                    if (jong > 0) parts.push(finalMap[jong]);
                    tokens.push({ type: 'hangul', value: parts.join(',') });
                } else if (/[0-9]/.test(char)) {
                    let numStr = "";
                    while (i < text.length && /[0-9]/.test(text[i])) {
                        numStr += text[i];
                        i++;
                    }
                    tokens.push({ type: 'number', value: '0' + numStr + '0' });
                    continue;
                } else {
                    tokens.push({ type: 'other', value: char });
                }
                i++;
            }

            let finalOutput = "";
            for (let j = 0; j < tokens.length; j++) {
                finalOutput += tokens[j].value;
                if (j < tokens.length - 1) {
                    let curr = tokens[j];
                    let next = tokens[j + 1];

                    // 1. í•œê¸€ ìŒì ˆê³¼ í•œê¸€ ìŒì ˆ ì‚¬ì´ëŠ” ë§ˆì¹¨í‘œ(.)
                    if (curr.type === 'hangul' && next.type === 'hangul') {
                        finalOutput += ".";
                    }
                    // 2. ìˆ«ì(0120)ì™€ í•œê¸€ ìŒì ˆ ì‚¬ì´ëŠ” ì‰¼í‘œ(,)ë¡œ ì—°ê²° (ì˜ˆ: 0120,6,03,2)
                    else if (curr.type === 'number' && next.type === 'hangul') {
                        finalOutput += ",";
                    }
                    else if (curr.type === 'hangul' && next.type === 'number') {
                        finalOutput += ",";
                    }
                }
            }
            document.getElementById('result').innerText = finalOutput;
        }

        function toKor() {
            let text = document.getElementById('input').value;
            const revInitial = Object.fromEntries(Object.entries(initialMap).map(([k, v]) => [v, CHOSUNG.indexOf(k)]));
            const revVowel = Object.fromEntries(Object.entries(vowelMap).map(([k, v]) => [v.join(','), JUNGSUNG.indexOf(k)]));
            const revFinal = Object.fromEntries(finalMap.map((v, i) => [v, i]));

            // ìˆ«ì ë­‰ì¹˜ ë³µì› (0120 -> 12)
            text = text.replace(/0([0-9]+)0/g, '$1');

            let tokens = []; let temp = "";
            for (let char of text) {
                if (char === '.' || char === ' ' || char === '\n') {
                    if (temp) tokens.push({ type: 'code', value: temp });
                    tokens.push({ type: 'sep', value: char });
                    temp = "";
                } else if (/[0-9,]/.test(char)) {
                    temp += char;
                } else {
                    if (temp) tokens.push({ type: 'code', value: temp });
                    tokens.push({ type: 'other', value: char });
                    temp = "";
                }
            }
            if (temp) tokens.push({ type: 'code', value: temp });

            let finalStr = "";
            for (let token of tokens) {
                if (token.type === 'sep') {
                    if (token.value !== '.') finalStr += token.value;
                    continue;
                }
                if (token.type === 'other') {
                    finalStr += token.value;
                    continue;
                }

                let parts = token.value.split(',');
                // ë§Œì•½ ìˆœìˆ˜ ìˆ«ìë¼ë©´ ê·¸ëƒ¥ ì¶œë ¥
                if (parts.length === 1 && !isNaN(parts[0])) {
                    finalStr += parts[0];
                    continue;
                }

                try {
                    // í•œê¸€ ì¡°í•© ì‹œë„
                    let currentIdx = 0;
                    while (currentIdx < parts.length) {
                        let choIdx = revInitial[parts[currentIdx]];
                        if (choIdx === undefined) {
                            // í•œê¸€ ììŒì´ ì•„ë‹ˆë©´ ìˆ«ì ë“±ìœ¼ë¡œ ì·¨ê¸‰
                            finalStr += parts[currentIdx];
                            currentIdx++;
                            continue;
                        }

                        let vStr = parts[currentIdx + 1];
                        let vStep = 1;
                        if (currentIdx + 2 < parts.length && revVowel[parts[currentIdx + 1] + ',' + parts[currentIdx + 2]] !== undefined) {
                            vStr = parts[currentIdx + 1] + ',' + parts[currentIdx + 2];
                            vStep = 2;
                        }

                        let jungIdx = revVowel[vStr];
                        if (jungIdx === undefined) {
                            finalStr += parts[currentIdx];
                            currentIdx++;
                            continue;
                        }

                        let jongIdx = 0;
                        if (parts[currentIdx + 1 + vStep] && revFinal[parts[currentIdx + 1 + vStep]] !== undefined && revInitial[parts[currentIdx + 1 + vStep]] === undefined) {
                            jongIdx = revFinal[parts[currentIdx + 1 + vStep]];
                            currentIdx += (2 + vStep);
                        } else {
                            currentIdx += (1 + vStep);
                        }

                        finalStr += String.fromCharCode(0xAC00 + (choIdx * 588) + (jungIdx * 28) + jongIdx);
                    }
                } catch (e) { finalStr += token.value; }
            }
            document.getElementById('result').innerText = finalStr;
        }
    </script>

</body>

</html>
